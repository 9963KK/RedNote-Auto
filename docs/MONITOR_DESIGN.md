# RedNote Auto ç›‘æ§ç³»ç»Ÿå®æ–½è®¡åˆ’

> ğŸ“… åˆ›å»ºæ—¶é—´: 2025-12-28
> ğŸ¯ ç›®æ ‡: å°† main.py ä½œä¸ºå®šæ—¶åŒ–ç³»ç»Ÿè¿›ç¨‹è¿è¡Œï¼Œæä¾› Web ç›‘æ§ç•Œé¢
> âš ï¸ æ›´æ–°: å·²ç§»é™¤ã€Œæ•°æ®åŒæ­¥/äº’åŠ¨ç›‘æ§ã€åŠŸèƒ½ï¼ˆåŸå› ï¼šå½“å‰ MCP è¿”å›ä¸»è¦æ˜¯é¦–é¡µ Feedï¼Œæ— æ³•ç¨³å®šå®šä½åˆ°â€œæœ¬äººå‘å¸–åˆ—è¡¨â€çš„äº’åŠ¨æ•°æ®ï¼‰ã€‚ç›‘æ§é¢æ¿ä»…ä¿ç•™å‘å¸ƒä»»åŠ¡è°ƒåº¦ã€æ‰‹åŠ¨è§¦å‘å’Œä»»åŠ¡å†å²ã€‚

---

## ä¸€ã€å½“å‰çŠ¶æ€

### âŒ main.py ç›®å‰ä¸æ”¯æŒå®šæ—¶è¿è¡Œ

å½“å‰çš„ `main.py` æ˜¯ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè„šæœ¬ï¼š
- æ²¡æœ‰å†…ç½®å®šæ—¶è°ƒåº¦å™¨
- æ¯æ¬¡è¿è¡Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ `python main.py`
- æ²¡æœ‰æ•°æ®æŒä¹…åŒ–ï¼ˆè¿è¡Œç»“æœåªä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼‰

### âœ… éœ€è¦æ·»åŠ çš„åŠŸèƒ½

1. **å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨** - è‡ªåŠ¨åœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œ
2. **Web ç›‘æ§ç•Œé¢** - å¯è§†åŒ–æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
3. **ç³»ç»ŸæœåŠ¡** - æŒä¹…åŒ–åå°è¿è¡Œ

---

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ¶æ„è®¾è®¡

```
æµè§ˆå™¨ (http://æœåŠ¡å™¨IP:9999)
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FastAPI Web æœåŠ¡ (app.py)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ é™æ€é¡µé¢æœåŠ¡ (monitor.html)  â”‚ â”‚
â”‚  â”‚ â€¢ å®šæ—¶ä»»åŠ¡ API (é…ç½®/è§¦å‘)     â”‚ â”‚
â”‚  â”‚ â€¢ æ•°æ®è¯»å– API (JSONæ–‡ä»¶)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ APScheduler å®šæ—¶è°ƒåº¦å™¨         â”‚ â”‚
â”‚  â”‚ â€¢ 09:30 å‘å¸ƒä»»åŠ¡ (å¯é…ç½®)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ•°æ®æ–‡ä»¶ (data/*.json)          â”‚
â”‚  â€¢ tasks.json - ä»»åŠ¡å†å²           â”‚
â”‚  â€¢ scheduler_config.json - å®šæ—¶é…ç½®â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   xiaohongshu-mcp-server            â”‚
â”‚   (http://1.13.18.167:18060/mcp)    â”‚
â”‚  â€¢ publish_content - å‘å¸ƒå†…å®¹       â”‚
â”‚  â€¢ check_login_status - ç™»å½•çŠ¶æ€    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 xiaohongshu-mcp å¯ç”¨å·¥å…·

å·²é€šè¿‡å®é™…è°ƒç”¨éªŒè¯çš„å·¥å…·ï¼š

| å·¥å…·åç§° | åŠŸèƒ½ | ç”¨é€” |
|---------|------|------|
| `publish_content` | å‘å¸ƒå›¾æ–‡ | å·²é›†æˆåˆ° main.py |
| `check_login_status` | æ£€æŸ¥ç™»å½•çŠ¶æ€ | ç¡®ä¿å·²ç™»å½• |

---

## ä¸‰ã€å®æ–½æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º Web æœåŠ¡ `app.py`

**åŠŸèƒ½ï¼š**
- FastAPI åº”ç”¨ï¼Œç«¯å£ **9999**
- é›†æˆ APScheduler å®šæ—¶ä»»åŠ¡è°ƒåº¦
- æä¾› API æ¥å£

**API æ¥å£ï¼š**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/` | è¿”å›ç›‘æ§é¡µé¢ |
| GET | `/api/schedule` | è·å–å®šæ—¶ä»»åŠ¡é…ç½® |
| POST | `/api/schedule` | æ›´æ–°å®šæ—¶ä»»åŠ¡é…ç½® |
| POST | `/api/tasks/trigger` | æ‰‹åŠ¨è§¦å‘ä»»åŠ¡ |
| GET | `/api/jobs` | è·å–å½“å‰è°ƒåº¦å™¨ä»»åŠ¡åˆ—è¡¨ |
| GET | `/api/data/{file_name}` | è¯»å–æ•°æ®æ–‡ä»¶ |

**é»˜è®¤å®šæ—¶é…ç½®ï¼š**
```json
{
  "publish_enabled": true,
  "publish_hour": 9,
  "publish_minute": 30
}
```

### æ­¥éª¤ 2: åˆ›å»ºå‰ç«¯é¡µé¢ `static/monitor.html`

**åŠŸèƒ½ï¼š**
- å®šæ—¶ä»»åŠ¡çŠ¶æ€ï¼ˆä¸‹æ¬¡è¿è¡Œæ—¶é—´ï¼‰
- å®šæ—¶ä»»åŠ¡é…ç½®å¼¹çª—ï¼ˆå¯ä¿®æ”¹å‘å¸ƒæ—¶é—´ï¼‰
- æ‰‹åŠ¨è§¦å‘å‘å¸ƒ
- å‘å¸ƒä»»åŠ¡å†å²åˆ—è¡¨ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼‰
- è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰

**æŠ€æœ¯æ ˆï¼š**
- TailwindCSS (CDN)
- åŸç”Ÿ JavaScript

### æ­¥éª¤ 3: åˆ›å»ºç³»ç»ŸæœåŠ¡

**systemd æœåŠ¡é…ç½®** (`/etc/systemd/system/rednote-monitor.service`)ï¼š

```ini
[Unit]
Description=RedNote Auto Monitor Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/RedNote-Auto
Environment="PATH=/root/RedNote-Auto/venv/bin"
ExecStart=/root/RedNote-Auto/venv/bin/python app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### æ­¥éª¤ 4: å®‰è£…ä¾èµ–å¹¶å¯åŠ¨æœåŠ¡

```bash
# å®‰è£…ä¾èµ–
pip install fastapi uvicorn apscheduler pydantic

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start rednote-monitor
sudo systemctl enable rednote-monitor
```

---

## å››ã€æ–‡ä»¶ç»“æ„

```
RedNote-Auto/
â”œâ”€â”€ app.py                        # Web æœåŠ¡ä¸»ç¨‹åº (æ–°å»º)
â”œâ”€â”€ main.py                       # è®ºæ–‡å‘å¸ƒè„šæœ¬ (å·²æœ‰)
â”‚
â”œâ”€â”€ static/                       # é™æ€æ–‡ä»¶ç›®å½• (æ–°å»º)
â”‚   â””â”€â”€ monitor.html              # ç›‘æ§é¡µé¢
â”‚
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½• (æ–°å»º)
â”‚   â”œâ”€â”€ scheduler_config.json     # å®šæ—¶ä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ tasks.json                # ä»»åŠ¡å†å²
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ MONITOR_DESIGN.md         # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ requirements-web.txt          # WebæœåŠ¡ä¾èµ– (æ–°å»º)
â””â”€â”€ ... (å…¶ä»–ç°æœ‰æ–‡ä»¶)
```

---

## äº”ã€æ•°æ®ç»“æ„

### 5.1 scheduler_config.json (å®šæ—¶é…ç½®)
```json
{
  "publish_enabled": true,
  "publish_hour": 9,
  "publish_minute": 30
}
```

### 5.2 tasks.json (ä»»åŠ¡å†å²)
```json
{
  "tasks": [
    {
      "task_id": "task_20251228_0930",
      "task_type": "publish",
      "status": "success",
      "start_time": "2025-12-28T09:30:00",
      "end_time": "2025-12-28T09:35:12",
      "papers_count": 5,
      "published_count": 1,
      "error_message": null
    }
  ]
}
```

---

## å…­ã€éƒ¨ç½²å‘½ä»¤

```bash
# 1. åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p static data

# 2. å®‰è£…ä¾èµ–
pip install fastapi uvicorn apscheduler pydantic

# 3. é¦–æ¬¡è¿è¡Œï¼ˆæµ‹è¯•ï¼‰
python app.py

# 4. è®¿é—®æµ‹è¯•
curl http://localhost:9999/api/jobs
# æˆ–æµè§ˆå™¨è®¿é—® http://localhost:9999

# 5. é…ç½®ç³»ç»ŸæœåŠ¡
sudo cp rednote-monitor.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl start rednote-monitor
sudo systemctl enable rednote-monitor

# 6. æŸ¥çœ‹çŠ¶æ€
sudo systemctl status rednote-monitor
sudo journalctl -u rednote-monitor -f
```

---

## ä¸ƒã€åŠŸèƒ½æ¸…å•

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å®šæ—¶ä»»åŠ¡é…ç½® | âœ… | é¡µé¢å¯ä¿®æ”¹å‘å¸ƒæ—¶é—´ |
| æ‰‹åŠ¨è§¦å‘ä»»åŠ¡ | âœ… | ä¸€é”®å‘å¸ƒ |
| ä»»åŠ¡çŠ¶æ€ç›‘æ§ | âœ… | å†å²è®°å½• |
| è‡ªåŠ¨åˆ·æ–° | âœ… | æ¯30ç§’ |
| æŒä¹…åŒ–è¿è¡Œ | âœ… | systemd æœåŠ¡ |
| ç«¯å£é…ç½® | âœ… | 9999 |

---

## å…«ã€ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RedNote Auto ç›‘æ§é¢æ¿    @AIè®ºæ–‡é€Ÿè§ˆ  [å®šæ—¶é…ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ğŸš€ å®šæ—¶ä»»åŠ¡çŠ¶æ€    [æ‰‹åŠ¨å‘å¸ƒ]                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è®ºæ–‡å‘å¸ƒä»»åŠ¡ | ä¸‹æ¬¡è¿è¡Œ: æ˜å¤© 09:30       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  ğŸ“ æœ€è¿‘ä»»åŠ¡                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… 2025-12-28 09:30 | è®ºæ–‡å‘å¸ƒ | æˆåŠŸ    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€æ³¨æ„äº‹é¡¹

1. **MCP è®¤è¯**ï¼šé¦–æ¬¡è¿è¡Œéœ€ç¡®ä¿ xiaohongshu-mcp-server å·²ç™»å½•
2. **æ—¥å¿—ç›‘æ§**ï¼šé€šè¿‡ `journalctl -u rednote-monitor -f` æŸ¥çœ‹è¿è¡Œæ—¥å¿—
3. **é˜²ç«å¢™**ï¼šç¡®ä¿ç«¯å£ 9999 å¯¹å¤–å¼€æ”¾ï¼ˆå¦‚éœ€è¿œç¨‹è®¿é—®ï¼‰

---

## åã€ä¸‹ä¸€æ­¥

ç¡®è®¤æ­¤è®¡åˆ’åï¼Œæˆ‘å°†åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

1. `app.py` - Web æœåŠ¡ä¸»ç¨‹åº
2. `static/monitor.html` - å‰ç«¯ç›‘æ§é¡µé¢
3. `requirements-web.txt` - ä¾èµ–æ–‡ä»¶
4. `rednote-monitor.service` - systemd æœåŠ¡é…ç½®

æ˜¯å¦å¼€å§‹å®æ–½ï¼Ÿ
